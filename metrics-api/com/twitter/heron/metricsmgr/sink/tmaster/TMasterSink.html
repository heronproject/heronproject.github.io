<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc (version 1.7.0_71) on Tue Dec 08 14:33:21 PST 2015 -->
<title>TMasterSink</title>
<meta name="date" content="2015-12-08">
<link rel="stylesheet" type="text/css" href="../../../../../../stylesheet.css" title="Style">
</head>
<body>
<script type="text/javascript"><!--
    if (location.href.indexOf('is-external=true') == -1) {
        parent.document.title="TMasterSink";
    }
//-->
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a name="navbar_top">
<!--   -->
</a><a href="#skip-navbar_top" title="Skip navigation links"></a><a name="navbar_top_firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../../index-all.html">Index</a></li>
<li><a href="../../../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../../../com/twitter/heron/metricsmgr/sink/tmaster/TMasterClient.html" title="class in com.twitter.heron.metricsmgr.sink.tmaster"><span class="strong">Prev Class</span></a></li>
<li><a href="../../../../../../com/twitter/heron/metricsmgr/sink/tmaster/TMasterSinkTest.html" title="class in com.twitter.heron.metricsmgr.sink.tmaster"><span class="strong">Next Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../../../index.html?com/twitter/heron/metricsmgr/sink/tmaster/TMasterSink.html" target="_top">Frames</a></li>
<li><a href="TMasterSink.html" target="_top">No Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../../../../../allclasses-noframe.html">All Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor_summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method_summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor_detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method_detail">Method</a></li>
</ul>
</div>
<a name="skip-navbar_top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="subTitle">com.twitter.heron.metricsmgr.sink.tmaster</div>
<h2 title="Class TMasterSink" class="title">Class TMasterSink</h2>
</div>
<div class="contentContainer">
<ul class="inheritance">
<li>java.lang.Object</li>
<li>
<ul class="inheritance">
<li>com.twitter.heron.metricsmgr.sink.tmaster.TMasterSink</li>
</ul>
</li>
</ul>
<div class="description">
<ul class="blockList">
<li class="blockList">
<dl>
<dt>All Implemented Interfaces:</dt>
<dd><a href="../../../../../../com/twitter/heron/metricsmgr/api/sink/IMetricsSink.html" title="interface in com.twitter.heron.metricsmgr.api.sink">IMetricsSink</a></dd>
</dl>
<hr>
<br>
<pre>public class <span class="strong">TMasterSink</span>
extends java.lang.Object
implements <a href="../../../../../../com/twitter/heron/metricsmgr/api/sink/IMetricsSink.html" title="interface in com.twitter.heron.metricsmgr.api.sink">IMetricsSink</a></pre>
<div class="block">An IMetricsSink sends Metrics to TMaster.
 1. It used StateManager to get the TMasterLocation
 <p/>
 2. Then it would construct a long-live Service running TMasterClient, which could automatically
 recover from uncaught exceptions, i.e. close the old one and start a new one.
 Also, it provides api to update the TMasterLocation that TMasterClient need to connect and
 restart the TMasterClient.
 There are two scenarios we need to restart a TMasterClient in our case:
 <p/>
 -- Uncaught exceptions happen within TMasterClient; then we would restart TMasterClient inside
 the same ExecutorService inside the UncaughtExceptionHandlers.
 Notice that, in java, exceptions occur inside UncaughtExceptionHandlers would not invoke
 UncaughtExceptionHandlers; instead, it would kill the thread with that exception.
 So if exceptions thrown during restart a new TMasterClient, this TMasterSink would die, and
 external logic would take care of it.
 <p/>
 -- TMasterLocation changes (though in fact, TMasterClient might also throw exceptions in this case),
 in this case, we would invoke TMasterService to start from tMasterLocationStarter's thread.
 But the TMasterService and TMasterClient still start wihtin the thread they run.
 <p/>
 3. When a new MetricsRecord comes by invoking processRecord, it would push the MetricsRecord
 to the Communicator Queue to TMasterClient
 <p/>
 Notice that we would not send all metrics to TMaster; we would use MetricsFilter to figure out
 needed metrics.</div>
</li>
</ul>
</div>
<div class="summary">
<ul class="blockList">
<li class="blockList">
<!-- ======== CONSTRUCTOR SUMMARY ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor_summary">
<!--   -->
</a>
<h3>Constructor Summary</h3>
<table class="overviewSummary" border="0" cellpadding="3" cellspacing="0" summary="Constructor Summary table, listing constructors, and an explanation">
<caption><span>Constructors</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colOne" scope="col">Constructor and Description</th>
</tr>
<tr class="altColor">
<td class="colOne"><code><strong><a href="../../../../../../com/twitter/heron/metricsmgr/sink/tmaster/TMasterSink.html#TMasterSink()">TMasterSink</a></strong>()</code>&nbsp;</td>
</tr>
</table>
</li>
</ul>
<!-- ========== METHOD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="method_summary">
<!--   -->
</a>
<h3>Method Summary</h3>
<table class="overviewSummary" border="0" cellpadding="3" cellspacing="0" summary="Method Summary table, listing methods, and an explanation">
<caption><span>Methods</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Method and Description</th>
</tr>
<tr class="altColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><strong><a href="../../../../../../com/twitter/heron/metricsmgr/sink/tmaster/TMasterSink.html#close()">close</a></strong>()</code>
<div class="block">Closes this stream and releases any system resources associated
 with it.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>protected void</code></td>
<td class="colLast"><code><strong><a href="../../../../../../com/twitter/heron/metricsmgr/sink/tmaster/TMasterSink.html#createSimpleTMasterClientService(java.util.Map)">createSimpleTMasterClientService</a></strong>(java.util.Map&lt;java.lang.String,java.lang.Object&gt;&nbsp;serviceConfig)</code>&nbsp;</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><strong><a href="../../../../../../com/twitter/heron/metricsmgr/sink/tmaster/TMasterSink.html#flush()">flush</a></strong>()</code>
<div class="block">Flush any buffered metrics
 It would be called at an interval according to the configuration</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>protected TopologyMaster.TMasterLocation</code></td>
<td class="colLast"><code><strong><a href="../../../../../../com/twitter/heron/metricsmgr/sink/tmaster/TMasterSink.html#getCurrentTMasterLocation()">getCurrentTMasterLocation</a></strong>()</code>&nbsp;</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>protected TopologyMaster.TMasterLocation</code></td>
<td class="colLast"><code><strong><a href="../../../../../../com/twitter/heron/metricsmgr/sink/tmaster/TMasterSink.html#getCurrentTMasterLocationInService()">getCurrentTMasterLocationInService</a></strong>()</code>&nbsp;</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>protected <a href="../../../../../../com/twitter/heron/metricsmgr/sink/tmaster/TMasterClient.html" title="class in com.twitter.heron.metricsmgr.sink.tmaster">TMasterClient</a></code></td>
<td class="colLast"><code><strong><a href="../../../../../../com/twitter/heron/metricsmgr/sink/tmaster/TMasterSink.html#getTMasterClient()">getTMasterClient</a></strong>()</code>&nbsp;</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>protected com.twitter.heron.metricsmgr.sink.tmaster.TMasterSink.TMasterClientService</code></td>
<td class="colLast"><code><strong><a href="../../../../../../com/twitter/heron/metricsmgr/sink/tmaster/TMasterSink.html#getTMasterClientService()">getTMasterClientService</a></strong>()</code>&nbsp;</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>protected int</code></td>
<td class="colLast"><code><strong><a href="../../../../../../com/twitter/heron/metricsmgr/sink/tmaster/TMasterSink.html#getTMasterStartedAttempts()">getTMasterStartedAttempts</a></strong>()</code>&nbsp;</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><strong><a href="../../../../../../com/twitter/heron/metricsmgr/sink/tmaster/TMasterSink.html#init(java.util.Map,%20com.twitter.heron.metricsmgr.api.sink.SinkContext)">init</a></strong>(java.util.Map&lt;java.lang.String,java.lang.Object&gt;&nbsp;conf,
    <a href="../../../../../../com/twitter/heron/metricsmgr/api/sink/SinkContext.html" title="interface in com.twitter.heron.metricsmgr.api.sink">SinkContext</a>&nbsp;context)</code>
<div class="block">Initialize the MetricsSink</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><strong><a href="../../../../../../com/twitter/heron/metricsmgr/sink/tmaster/TMasterSink.html#processRecord(com.twitter.heron.metricsmgr.api.metrics.MetricsRecord)">processRecord</a></strong>(<a href="../../../../../../com/twitter/heron/metricsmgr/api/metrics/MetricsRecord.html" title="class in com.twitter.heron.metricsmgr.api.metrics">MetricsRecord</a>&nbsp;record)</code>
<div class="block">Process a metrics record in the sink</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>protected void</code></td>
<td class="colLast"><code><strong><a href="../../../../../../com/twitter/heron/metricsmgr/sink/tmaster/TMasterSink.html#startNewTMasterClient(TopologyMaster.TMasterLocation)">startNewTMasterClient</a></strong>(TopologyMaster.TMasterLocation&nbsp;location)</code>&nbsp;</td>
</tr>
</table>
<ul class="blockList">
<li class="blockList"><a name="methods_inherited_from_class_java.lang.Object">
<!--   -->
</a>
<h3>Methods inherited from class&nbsp;java.lang.Object</h3>
<code>clone, equals, finalize, getClass, hashCode, notify, notifyAll, toString, wait, wait, wait</code></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="details">
<ul class="blockList">
<li class="blockList">
<!-- ========= CONSTRUCTOR DETAIL ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor_detail">
<!--   -->
</a>
<h3>Constructor Detail</h3>
<a name="TMasterSink()">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>TMasterSink</h4>
<pre>public&nbsp;TMasterSink()</pre>
</li>
</ul>
</li>
</ul>
<!-- ============ METHOD DETAIL ========== -->
<ul class="blockList">
<li class="blockList"><a name="method_detail">
<!--   -->
</a>
<h3>Method Detail</h3>
<a name="init(java.util.Map, com.twitter.heron.metricsmgr.api.sink.SinkContext)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>init</h4>
<pre>public&nbsp;void&nbsp;init(java.util.Map&lt;java.lang.String,java.lang.Object&gt;&nbsp;conf,
        <a href="../../../../../../com/twitter/heron/metricsmgr/api/sink/SinkContext.html" title="interface in com.twitter.heron.metricsmgr.api.sink">SinkContext</a>&nbsp;context)</pre>
<div class="block"><strong>Description copied from interface:&nbsp;<code><a href="../../../../../../com/twitter/heron/metricsmgr/api/sink/IMetricsSink.html#init(java.util.Map,%20com.twitter.heron.metricsmgr.api.sink.SinkContext)">IMetricsSink</a></code></strong></div>
<div class="block">Initialize the MetricsSink</div>
<dl>
<dt><strong>Specified by:</strong></dt>
<dd><code><a href="../../../../../../com/twitter/heron/metricsmgr/api/sink/IMetricsSink.html#init(java.util.Map,%20com.twitter.heron.metricsmgr.api.sink.SinkContext)">init</a></code>&nbsp;in interface&nbsp;<code><a href="../../../../../../com/twitter/heron/metricsmgr/api/sink/IMetricsSink.html" title="interface in com.twitter.heron.metricsmgr.api.sink">IMetricsSink</a></code></dd>
<dt><span class="strong">Parameters:</span></dt><dd><code>conf</code> - An unmodifiableMap containing basic configuration</dd><dd><code>context</code> - context objects for Sink to init
 Attempts to modify the returned map,
 whether direct or via its collection views, result in an UnsupportedOperationException.</dd></dl>
</li>
</ul>
<a name="processRecord(com.twitter.heron.metricsmgr.api.metrics.MetricsRecord)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>processRecord</h4>
<pre>public&nbsp;void&nbsp;processRecord(<a href="../../../../../../com/twitter/heron/metricsmgr/api/metrics/MetricsRecord.html" title="class in com.twitter.heron.metricsmgr.api.metrics">MetricsRecord</a>&nbsp;record)</pre>
<div class="block"><strong>Description copied from interface:&nbsp;<code><a href="../../../../../../com/twitter/heron/metricsmgr/api/sink/IMetricsSink.html#processRecord(com.twitter.heron.metricsmgr.api.metrics.MetricsRecord)">IMetricsSink</a></code></strong></div>
<div class="block">Process a metrics record in the sink</div>
<dl>
<dt><strong>Specified by:</strong></dt>
<dd><code><a href="../../../../../../com/twitter/heron/metricsmgr/api/sink/IMetricsSink.html#processRecord(com.twitter.heron.metricsmgr.api.metrics.MetricsRecord)">processRecord</a></code>&nbsp;in interface&nbsp;<code><a href="../../../../../../com/twitter/heron/metricsmgr/api/sink/IMetricsSink.html" title="interface in com.twitter.heron.metricsmgr.api.sink">IMetricsSink</a></code></dd>
<dt><span class="strong">Parameters:</span></dt><dd><code>record</code> - the record to put</dd></dl>
</li>
</ul>
<a name="flush()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>flush</h4>
<pre>public&nbsp;void&nbsp;flush()</pre>
<div class="block"><strong>Description copied from interface:&nbsp;<code><a href="../../../../../../com/twitter/heron/metricsmgr/api/sink/IMetricsSink.html#flush()">IMetricsSink</a></code></strong></div>
<div class="block">Flush any buffered metrics
 It would be called at an interval according to the configuration</div>
<dl>
<dt><strong>Specified by:</strong></dt>
<dd><code><a href="../../../../../../com/twitter/heron/metricsmgr/api/sink/IMetricsSink.html#flush()">flush</a></code>&nbsp;in interface&nbsp;<code><a href="../../../../../../com/twitter/heron/metricsmgr/api/sink/IMetricsSink.html" title="interface in com.twitter.heron.metricsmgr.api.sink">IMetricsSink</a></code></dd>
</dl>
</li>
</ul>
<a name="close()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>close</h4>
<pre>public&nbsp;void&nbsp;close()</pre>
<div class="block"><strong>Description copied from interface:&nbsp;<code><a href="../../../../../../com/twitter/heron/metricsmgr/api/sink/IMetricsSink.html#close()">IMetricsSink</a></code></strong></div>
<div class="block">Closes this stream and releases any system resources associated
 with it. If the stream is already closed then invoking this
 method has no effect.</div>
<dl>
<dt><strong>Specified by:</strong></dt>
<dd><code><a href="../../../../../../com/twitter/heron/metricsmgr/api/sink/IMetricsSink.html#close()">close</a></code>&nbsp;in interface&nbsp;<code><a href="../../../../../../com/twitter/heron/metricsmgr/api/sink/IMetricsSink.html" title="interface in com.twitter.heron.metricsmgr.api.sink">IMetricsSink</a></code></dd>
</dl>
</li>
</ul>
<a name="getTMasterClientService()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getTMasterClientService</h4>
<pre>protected&nbsp;com.twitter.heron.metricsmgr.sink.tmaster.TMasterSink.TMasterClientService&nbsp;getTMasterClientService()</pre>
</li>
</ul>
<a name="createSimpleTMasterClientService(java.util.Map)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>createSimpleTMasterClientService</h4>
<pre>protected&nbsp;void&nbsp;createSimpleTMasterClientService(java.util.Map&lt;java.lang.String,java.lang.Object&gt;&nbsp;serviceConfig)</pre>
</li>
</ul>
<a name="getTMasterClient()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getTMasterClient</h4>
<pre>protected&nbsp;<a href="../../../../../../com/twitter/heron/metricsmgr/sink/tmaster/TMasterClient.html" title="class in com.twitter.heron.metricsmgr.sink.tmaster">TMasterClient</a>&nbsp;getTMasterClient()</pre>
</li>
</ul>
<a name="startNewTMasterClient(TopologyMaster.TMasterLocation)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>startNewTMasterClient</h4>
<pre>protected&nbsp;void&nbsp;startNewTMasterClient(TopologyMaster.TMasterLocation&nbsp;location)</pre>
</li>
</ul>
<a name="getTMasterStartedAttempts()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getTMasterStartedAttempts</h4>
<pre>protected&nbsp;int&nbsp;getTMasterStartedAttempts()</pre>
</li>
</ul>
<a name="getCurrentTMasterLocation()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getCurrentTMasterLocation</h4>
<pre>protected&nbsp;TopologyMaster.TMasterLocation&nbsp;getCurrentTMasterLocation()</pre>
</li>
</ul>
<a name="getCurrentTMasterLocationInService()">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>getCurrentTMasterLocationInService</h4>
<pre>protected&nbsp;TopologyMaster.TMasterLocation&nbsp;getCurrentTMasterLocationInService()</pre>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<!-- ========= END OF CLASS DATA ========= -->
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a name="navbar_bottom">
<!--   -->
</a><a href="#skip-navbar_bottom" title="Skip navigation links"></a><a name="navbar_bottom_firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../../index-all.html">Index</a></li>
<li><a href="../../../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../../../com/twitter/heron/metricsmgr/sink/tmaster/TMasterClient.html" title="class in com.twitter.heron.metricsmgr.sink.tmaster"><span class="strong">Prev Class</span></a></li>
<li><a href="../../../../../../com/twitter/heron/metricsmgr/sink/tmaster/TMasterSinkTest.html" title="class in com.twitter.heron.metricsmgr.sink.tmaster"><span class="strong">Next Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../../../index.html?com/twitter/heron/metricsmgr/sink/tmaster/TMasterSink.html" target="_top">Frames</a></li>
<li><a href="TMasterSink.html" target="_top">No Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../../../../../allclasses-noframe.html">All Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor_summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method_summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor_detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method_detail">Method</a></li>
</ul>
</div>
<a name="skip-navbar_bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
</body>
</html>
